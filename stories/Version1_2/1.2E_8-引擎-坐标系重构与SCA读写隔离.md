# 1.2E_8-引擎-坐标系重构与SCA读写隔离

## 核心改动

本次更新对引擎底层的坐标系统和超级区块归档（SCA）的读写架构进行了重大重构。

### 1. 统一坐标系体系完善
在 1.2E_7 引入的基础坐标系组件 (`Pos`, `ChunkPos`, `LocalPos`, `ScaPos`) 之上，我们发现原有的 `ScaPos` 职责不清，既负责定位文件又负责定位文件内位置，导致了架构上的混淆。

为此，我们引入了缺失的拼图，明确了各层级坐标的语义和职责：

- **`Pos`**: 世界绝对坐标（Block级）。(1.2E_7 已有)
- **`ChunkPos`**: 世界区块坐标（Chunk级）。(1.2E_7 已有)
- **`ChunkLocalPos`**: 区块内局部坐标（Block级，决定方块在区块内的位置）。(1.2E_7 已有)
- **`ScaPos` (职责修正)**: **SCA文件坐标**（Area级）。
    - *变动*：剔除了所有关于文件内部索引计算的逻辑。
    - *职责*：现在它纯粹地表示“这个区块在哪个 `.sca` 文件里”。
- **`ScaLocalPos` (新增)**: **SCA内部局部坐标**（Local级）。
    - *定义*：表示区块在 SCA 文件内部的网格位置 (0-39)。
    - *职责*：负责核心的索引计算 (`index = z * 40 + x`) 和物理字节偏移量计算 (`offset = header + index * 8`)。
    - *意义*：它是 SCA 文件读写的核心 Key，底层 IO 现在只认这个坐标。

### 2. SCA 读写架构分层
为了解决旧架构中"坐标转换"与"文件IO"高度耦合的问题，我们实施了严格的分层设计：
- **底层 (SuperChunkArchiveFile)**: 
    - 彻底移除了对世界坐标 (`ChunkPos`) 的依赖。
    - 现在只接受简单的局部坐标 (`int localX`, `int localZ`) 进行读写。
    - 专注于底层的字节流操作和文件指针管理。
    - 修复了 `compact` 碎片整理方法在非原点区域无法正确工作的重大 BUG。
- **管理层 (ArchiveSuperChunkManager)**:
    - 接管了所有的坐标转换逻辑。
    - 负责将上层请求的 `ChunkPos` 转换为对应的 `ScaPos` (定位文件) 和 `ScaLocalPos` (定位文件内位置)。
    - 优化了 SCAF 文件句柄缓存机制，现在使用唯一的文件标识作为缓存 Key，杜绝了重复打开同一文件的风险。

### 3. 工具类解耦
- 废弃并计划移除臃肿的 `ChunkUtils`，将其核心逻辑分散到各个专业的坐标类中，实现了高内聚低耦合的设计目标。
- 引入 `EngineDefault` 统一管理引擎常量（如 SCA 封装大小），消除了魔术数字。

## 影响范围
- 所有涉及区块存储读写的模块。
- 坐标系统的调用方需要适配新的转换 API。
